<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Zenn Article Audio Reader</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 50%, #0f0f0f 100%);
      min-height: 100vh;
      padding: 2rem 1rem;
      color: #ffffff;
      position: relative;
    }
    
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        radial-gradient(circle at 20% 30%, rgba(74, 158, 255, 0.08) 0%, transparent 50%),
        radial-gradient(circle at 80% 70%, rgba(138, 43, 226, 0.06) 0%, transparent 50%);
      pointer-events: none;
      z-index: 0;
    }
    
    .header {
      max-width: 800px;
      margin: 0 auto 2rem;
      text-align: center;
      position: relative;
      z-index: 1;
      padding: 3rem 2rem 2rem;
      border-bottom: 1px solid #333;
      background: linear-gradient(135deg, rgba(15, 15, 15, 0.6) 0%, rgba(30, 30, 30, 0.6) 100%);
      border-radius: 16px;
    }
    
    .header-icon {
      width: 80px;
      height: 80px;
      margin: 0 auto 1.5rem;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3rem;
    }
    
    .header h1 {
      background: linear-gradient(90deg, 
        #b8b8b8 0%, 
        #ffffff 20%,
        #e0e0e0 40%,
        #ffffff 60%,
        #d0d0d0 80%,
        #a0a0a0 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-size: 1.8rem;
      margin-bottom: 1.5rem;
      font-weight: 700;
      letter-spacing: -0.02em;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
    }
    
    .header-title-icon {
      width: 40px;
      height: 40px;
      flex-shrink: 0;
    }
    
    .header-meta {
      display: flex;
      justify-content: center;
      gap: 2rem;
      font-size: 0.9rem;
      color: #999;
    }
    
    .header-meta-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .article-header {
      text-align: center;
      margin-bottom: 1.5rem;
    }
    
    .article-icon {
      width: 60px;
      height: 60px;
      margin: 0 auto 1rem;
      background: rgba(255, 255, 255, 0.08);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
    }
    
    .article-title {
      background: linear-gradient(90deg, 
        #ffffff 0%, 
        #e0e0e0 50%,
        #ffffff 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 1rem;
      letter-spacing: -0.01em;
      text-align: center;
    }
    
    .article-date {
      font-size: 0.85rem;
      color: #999;
      text-align: center;
    }
    
    .article-url {
      font-size: 0.85rem;
      text-align: center;
      margin-top: 0.5rem;
    }
    
    .article-url a {
      color: #4a9eff;
      text-decoration: none;
      transition: color 0.3s ease;
    }
    
    .article-url a:hover {
      color: #6bb5ff;
      text-decoration: underline;
    }
    
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: linear-gradient(135deg, 
        rgba(15, 15, 15, 0.95) 0%, 
        rgba(30, 30, 30, 0.95) 30%,
        rgba(50, 50, 50, 0.95) 70%,
        rgba(35, 35, 35, 0.95) 100%);
      border-radius: 16px;
      padding: 3rem 2rem;
      box-shadow: 
        0 20px 60px rgba(0, 0, 0, 0.8),
        inset 0 1px 0 rgba(255, 255, 255, 0.15);
      border: 1px solid rgba(255, 255, 255, 0.15);
      position: relative;
      z-index: 1;
    }
    
    .player {
      background: linear-gradient(135deg, 
        rgba(20, 20, 20, 0.8) 0%, 
        rgba(35, 35, 35, 0.8) 100%);
      border-radius: 12px;
      padding: 2rem;
      margin-bottom: 1.5rem;
      border: 1px solid rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
    }
    
    .thumbnail {
      width: 100%;
      height: 240px;
      object-fit: cover;
      border-radius: 8px;
      margin-bottom: 1.5rem;
      border: 1px solid rgba(255, 255, 255, 0.15);
      transition: all 0.3s ease;
    }
    
    .thumbnail:hover {
      border-color: rgba(201, 169, 97, 0.4);
      box-shadow: 0 8px 24px rgba(201, 169, 97, 0.3);
    }
    
    .progress-container {
      background: rgba(255, 255, 255, 0.1);
      height: 10px;
      border-radius: 5px;
      margin-bottom: 20px;
      cursor: pointer;
      position: relative;
      transition: background 0.3s ease;
      border: 1px solid rgba(255, 255, 255, 0.05);
      user-select: none;
    }
    
    .progress-container:focus {
      outline: 2px solid rgba(201, 169, 97, 0.6);
      outline-offset: 2px;
    }
    
    .progress-container:hover {
      background: rgba(255, 255, 255, 0.15);
    }
    
    .progress-bar {
      background: linear-gradient(90deg, #c9a961 0%, #d4af77 50%, #c9a961 100%);
      height: 100%;
      border-radius: 5px;
      width: 0%;
      transition: width 0.1s linear;
      box-shadow: 0 0 15px rgba(201, 169, 97, 0.6), 0 0 5px rgba(201, 169, 97, 0.3);
      position: relative;
    }
    
    .progress-bar::after {
      content: '';
      position: absolute;
      right: 0;
      top: 50%;
      transform: translateY(-50%);
      width: 12px;
      height: 12px;
      background: #d4af77;
      border-radius: 50%;
      box-shadow: 0 0 8px rgba(201, 169, 97, 0.8);
      border: 2px solid rgba(255, 255, 255, 0.3);
    }
    
    .time-display {
      display: flex;
      justify-content: space-between;
      font-size: 14px;
      color: #999;
      margin-bottom: 20px;
    }
    
    .controls {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-bottom: 20px;
    }
    
    button {
      background: linear-gradient(135deg, rgba(58, 58, 74, 0.4), rgba(74, 74, 90, 0.4));
      color: #ffffff;
      border: 1px solid rgba(255, 255, 255, 0.2);
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      font-weight: 600;
      backdrop-filter: blur(10px);
    }
    
    button:hover {
      background: linear-gradient(135deg, rgba(58, 58, 74, 0.6), rgba(74, 74, 90, 0.6));
      border-color: rgba(201, 169, 97, 0.4);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(201, 169, 97, 0.3);
    }
    
    button:active {
      transform: translateY(0);
    }
    
    button:disabled {
      opacity: 0.4;
      cursor: not-allowed;
      transform: none;
    }
    
    .chunk-info {
      text-align: center;
      font-size: 14px;
      color: #999;
      margin-bottom: 15px;
    }
    
    .article-list {
      max-height: 400px;
      overflow-y: auto;
      background: linear-gradient(135deg, 
        rgba(20, 20, 20, 0.6) 0%, 
        rgba(30, 30, 30, 0.6) 100%);
      border-radius: 10px;
      padding: 15px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .article-item {
      padding: 12px 15px;
      margin-bottom: 10px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 15px;
      color: #ccc;
      border: 1px solid transparent;
      background: rgba(30, 30, 30, 0.5);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .article-item-date {
      font-size: 0.75rem;
      color: #666;
      min-width: 80px;
      flex-shrink: 0;
    }
    
    .article-item-title {
      flex: 1;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    
    .article-item-like {
      display: flex;
      align-items: center;
      gap: 4px;
      padding: 4px 8px;
      border-radius: 4px;
      transition: all 0.2s ease;
      cursor: pointer;
      user-select: none;
      flex-shrink: 0;
      font-size: 0.9rem;
    }
    
    .article-item-like:hover {
      background: rgba(255, 255, 255, 0.1);
    }
    
    .article-item-like-icon {
      font-size: 1rem;
      transition: all 0.2s ease;
    }
    
    .article-item-like:hover .article-item-like-icon {
      transform: scale(1.2);
    }
    
    .article-item-like.liked .article-item-like-icon {
      color: #ff6b6b;
    }
    
    .article-item-like-count {
      font-size: 0.85rem;
      color: #999;
      min-width: 20px;
      text-align: right;
    }
    
    .article-item:hover {
      background: rgba(255, 255, 255, 0.08);
      color: #ffffff;
      border-color: rgba(255, 255, 255, 0.2);
      transform: translateX(5px);
    }
    
    .article-item.active {
      background: linear-gradient(135deg, rgba(58, 58, 74, 0.6), rgba(74, 74, 90, 0.6));
      color: #ffffff;
      font-weight: 600;
      border-color: rgba(201, 169, 97, 0.5);
      box-shadow: 0 4px 12px rgba(201, 169, 97, 0.3);
    }
    
    .article-list-title {
      font-size: 16px;
      font-weight: 600;
      color: #999;
      margin-bottom: 15px;
      text-align: center;
    }
    
    .loading {
      text-align: center;
      color: #999;
      padding: 20px;
    }
    
    .loading-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 12px;
      z-index: 10;
    }
    
    .spinner {
      color: #c9a961;
      font-size: 16px;
      font-weight: 600;
      animation: pulse 1.5s ease-in-out infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .speed-control {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin-top: 15px;
    }
    
    .speed-control label {
      font-size: 14px;
      color: #999;
    }
    
    .speed-control select {
      padding: 8px 12px;
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      background: rgba(20, 20, 20, 0.8);
      color: #ffffff;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .speed-control select:hover {
      border-color: rgba(255, 255, 255, 0.3);
      background: rgba(30, 30, 30, 0.8);
    }
    
    .voice-control {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin-top: 10px;
    }
    
    .voice-control label {
      font-size: 14px;
      color: #999;
    }
    
    .voice-control select {
      padding: 8px 12px;
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      background: rgba(20, 20, 20, 0.8);
      color: #ffffff;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .voice-control select:hover {
      border-color: rgba(255, 255, 255, 0.3);
      background: rgba(30, 30, 30, 0.8);
    }
    
    .volume-control {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin-top: 10px;
    }
    
    .volume-control label {
      font-size: 14px;
      color: #999;
    }
    
    .volume-control input[type="range"] {
      width: 150px;
      height: 6px;
      border-radius: 3px;
      background: rgba(255, 255, 255, 0.1);
      outline: none;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    
    .volume-control input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: linear-gradient(135deg, #c9a961 0%, #d4af77 100%);
      cursor: pointer;
      border: 2px solid rgba(201, 169, 97, 0.4);
      transition: all 0.3s ease;
    }
    
    .volume-control input[type="range"]::-webkit-slider-thumb:hover {
      background: linear-gradient(135deg, #d4af77 0%, #e0bf8d 100%);
      border-color: rgba(201, 169, 97, 0.7);
      transform: scale(1.1);
      box-shadow: 0 0 10px rgba(201, 169, 97, 0.5);
    }
    
    .volume-control input[type="range"]::-moz-range-thumb {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: linear-gradient(135deg, #c9a961 0%, #d4af77 100%);
      cursor: pointer;
      border: 2px solid rgba(201, 169, 97, 0.4);
      transition: all 0.3s ease;
    }
    
    .volume-control input[type="range"]::-moz-range-thumb:hover {
      background: linear-gradient(135deg, #d4af77 0%, #e0bf8d 100%);
      border-color: rgba(201, 169, 97, 0.7);
      transform: scale(1.1);
      box-shadow: 0 0 10px rgba(201, 169, 97, 0.5);
    }
    
    .volume-value {
      font-size: 14px;
      color: #ccc;
      min-width: 35px;
      text-align: right;
    }
    
    @media (max-width: 768px) {
      body {
        padding: 1rem 0.5rem;
      }
      
      .container {
        padding: 2rem 1rem;
        border-radius: 12px;
      }
      
      .header h1 {
        font-size: 1.5rem;
      }
      
      .article-title {
        font-size: 1.2rem;
      }
      
      .player {
        padding: 1.5rem;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>
      <svg class="header-title-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <linearGradient id="iconGradient" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" style="stop-color:#4a9eff;stop-opacity:1" />
            <stop offset="50%" style="stop-color:#6bb5ff;stop-opacity:1" />
            <stop offset="100%" style="stop-color:#8ac5ff;stop-opacity:1" />
          </linearGradient>
        </defs>
        <!-- Èü≥Â£∞Ê≥¢ÂΩ¢„Ç¢„Ç§„Ç≥„É≥ -->
        <path d="M12 3v18M8 6v12M16 6v12M4 9v6M20 9v6" 
              stroke="url(#iconGradient)" 
              stroke-width="2.5" 
              stroke-linecap="round"/>
        <!-- ÂÜçÁîü„Éú„Çø„É≥‰∏≠Â§Æ -->
        <circle cx="12" cy="12" r="4" fill="url(#iconGradient)" opacity="0.3"/>
        <path d="M11 10l3 2-3 2V10z" fill="url(#iconGradient)"/>
      </svg>
      Zenn Article Audio Reader
    </h1>
  </div>
  
  <div class="container">
    <div class="player" style="position: relative;">
      <div class="loading-overlay" id="loadingOverlay" style="display: none;">
        <div class="spinner">Loading...</div>
      </div>
      
      <div class="article-header">
        <p class="article-title" id="articleTitle">Ë™≠„ÅøËæº„Åø‰∏≠...</p>
        <p class="article-date" id="articleDate">üìÖ ÂÖ¨ÈñãÊó•„ÇíË™≠„ÅøËæº„Åø‰∏≠...</p>
        <p class="article-url"><a id="articleLink" href="#" target="_blank" rel="noopener noreferrer">üîó Zenn„ÅßË®ò‰∫ã„ÇíË™≠„ÇÄ</a></p>
      </div>
      
      <img src="/web/affinity-thumbnail.jpg" alt="Article Thumbnail" class="thumbnail">
      
      <div class="progress-container" 
           id="progressContainer" 
           role="slider" 
           aria-label="Audio playback progress" 
           aria-valuemin="0" 
           aria-valuemax="100" 
           aria-valuenow="0" 
           tabindex="0">
        <div class="progress-bar" id="progressBar"></div>
      </div>
      
      <div class="time-display">
        <span id="currentTime">0:00</span>
        <span id="totalTime">0:00</span>
      </div>
      
      <div class="chunk-info" id="chunkInfo">Article 0 / 0</div>
      
      <div class="controls">
        <button id="prevBtn" disabled>Previous</button>
        <button id="playBtn">Play</button>
        <button id="nextBtn" disabled>Next</button>
      </div>
      
      <div class="speed-control">
        <label for="speedSelect">Playback Speed:</label>
        <select id="speedSelect">
          <option value="1.0">1.0x</option>
          <option value="1.2">1.2x</option>
          <option value="1.3">1.3x</option>
          <option value="1.4" selected>1.4x</option>
          <option value="1.5">1.5x</option>
          <option value="1.6">1.6x</option>
          <option value="2.0">2.0x</option>
        </select>
      </div>
      
      <div class="voice-control">
        <label for="voiceSelect">Voice:</label>
        <select id="voiceSelect">
          <option value="ja-male" selected>Japanese Male (Google Cloud TTS)</option>
          <option value="ja-female">Japanese Female (Google Cloud TTS)</option>
        </select>
      </div>
      
      <div class="volume-control">
        <label for="volumeSlider">Volume:</label>
        <input type="range" id="volumeSlider" min="0" max="100" value="50">
        <span class="volume-value" id="volumeValue">50%</span>
      </div>
    </div>
    
    <div class="article-list" id="articleList">
      <div class="article-list-title">Article List</div>
      <div class="loading">Loading...</div>
    </div>
  </div>
  
  <audio id="audio" preload="auto"></audio>
  
  <script>
    const audio = document.getElementById('audio');
    const playBtn = document.getElementById('playBtn');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const progressBar = document.getElementById('progressBar');
    const progressContainer = document.getElementById('progressContainer');
    const currentTimeDisplay = document.getElementById('currentTime');
    const totalTimeDisplay = document.getElementById('totalTime');
    const chunkInfo = document.getElementById('chunkInfo');
    const articleList = document.getElementById('articleList');
    const articleTitle = document.getElementById('articleTitle');
    const articleDate = document.getElementById('articleDate');
    const speedSelect = document.getElementById('speedSelect');
    const voiceSelect = document.getElementById('voiceSelect');
    const volumeSlider = document.getElementById('volumeSlider');
    const volumeValue = document.getElementById('volumeValue');
    const loadingOverlay = document.getElementById('loadingOverlay');
    
    let articles = [];
    let currentArticleIndex = 0;
    let currentVoice = 'ja-male';
    let isDragging = false;
    let dragStarted = false;
    let isLoading = false;
    
    // Âà©Áî®ÂèØËÉΩ„Å™Ë®ò‰∫ã„É™„Çπ„Éà
    const availableArticles = [
      {
        slug: 'affinity-3-free-canva-ai-strategy-2025',
        title: 'AffinityÁÑ°ÊñôÂåñ„ÅßCanva„ÅÆAIÊà¶Áï•„ÅåÊòé„Çâ„Åã„Å´',
        thumbnail: '/web/affinity-thumbnail.jpg',
        publishDate: '2025/11/06',
        url: 'https://zenn.dev/dragonrondo/articles/affinity-3-free-canva-ai-strategy-2025',
        likes: 0
      },
      {
        slug: 'ai-agents-70-percent-failure-reality-2025',
        title: 'AI„Ç®„Éº„Ç∏„Çß„É≥„Éà„ÅÆ70%„ÅåÂ§±Êïó„Åô„ÇãÁèæÂÆü',
        thumbnail: '/web/ai-agents-thumbnail.jpg',
        publishDate: '2025/11/07',
        url: 'https://zenn.dev/dragonrondo/articles/ai-agents-70-percent-failure-reality-2025',
        likes: 0
      }
    ];
    
    // Ë®ò‰∫ã‰∏ÄË¶ßË™≠„ÅøËæº„Åø
    async function loadArticles() {
      try {
        articles = availableArticles;
        renderArticleList();
        loadArticle(0);
      } catch (error) {
        articleList.innerHTML = '<div class="loading">Error: Failed to load articles</div>';
        console.error('Articles load error:', error);
      }
    }
    
    // Ë®ò‰∫ãÊÉÖÂ†±Êõ¥Êñ∞
    function updateArticleInfo() {
      chunkInfo.textContent = `Article ${currentArticleIndex + 1} / ${articles.length}`;
    }
    
    // „ÅÑ„ÅÑ„Å≠‰ª∂Êï∞„ÇíÂèñÂæó
    function getLikeCount(slug) {
      const count = localStorage.getItem(`article_${slug}_count`);
      return count ? parseInt(count) : 0;
    }
    
    // „ÅÑ„ÅÑ„Å≠‰ª∂Êï∞„ÇíË®≠ÂÆö
    function setLikeCount(slug, count) {
      localStorage.setItem(`article_${slug}_count`, count.toString());
    }
    
    // Ë®ò‰∫ã„É™„Çπ„ÉàË°®Á§∫
    function renderArticleList() {
      const listHTML = '<div class="article-list-title">Article List</div>' +
        articles.map((article, index) => {
          const liked = localStorage.getItem(`article_${article.slug}_liked`) === 'true';
          const likeCount = getLikeCount(article.slug);
          return `<div class="article-item ${index === currentArticleIndex ? 'active' : ''}" 
                       data-index="${index}">
                    <span class="article-item-date">${article.publishDate}</span>
                    <span class="article-item-title">${article.title}</span>
                    <span class="article-item-like ${liked ? 'liked' : ''}" 
                          data-slug="${article.slug}"
                          onclick="event.stopPropagation(); toggleLike('${article.slug}')">
                      <span class="article-item-like-icon">${liked ? '‚ô•' : '‚ô°'}</span>
                      <span class="article-item-like-count">${likeCount}</span>
                    </span>
                  </div>`;
        }).join('');
      
      articleList.innerHTML = listHTML;
      
      // „ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà
      document.querySelectorAll('.article-item').forEach(item => {
        item.addEventListener('click', (e) => {
          if (!e.target.closest('.article-item-like')) {
            const index = parseInt(item.dataset.index);
            loadArticle(index);
          }
        });
      });
    }
    
    // „ÅÑ„ÅÑ„Å≠Âàá„ÇäÊõø„Åà
    function toggleLike(slug) {
      const currentState = localStorage.getItem(`article_${slug}_liked`) === 'true';
      const currentCount = getLikeCount(slug);
      
      if (currentState) {
        // „ÅÑ„ÅÑ„Å≠Ëß£Èô§
        localStorage.setItem(`article_${slug}_liked`, 'false');
        setLikeCount(slug, Math.max(0, currentCount - 1));
      } else {
        // „ÅÑ„ÅÑ„Å≠ËøΩÂä†
        localStorage.setItem(`article_${slug}_liked`, 'true');
        setLikeCount(slug, currentCount + 1);
      }
      
      renderArticleList();
    }
    
    // „É≠„Éº„Éá„Ç£„É≥„Ç∞Ë°®Á§∫Âà∂Âæ°
    function showLoading() {
      isLoading = true;
      loadingOverlay.style.display = 'flex';
    }
    
    function hideLoading() {
      isLoading = false;
      loadingOverlay.style.display = 'none';
    }
    
    // „ÉÅ„É£„É≥„ÇØÂÜçÁîüÁî®„ÅÆÂ§âÊï∞
    let currentChunks = [];
    let currentChunkIndex = 0;
    
    // Ë®ò‰∫ãË™≠„ÅøËæº„Åø
    async function loadArticle(index) {
      if (index < 0 || index >= articles.length) return;
      
      showLoading();
      
      currentArticleIndex = index;
      const article = articles[index];
      const audioBasePath = `../audio/${article.slug}/`;
      
      // „Çø„Ç§„Éà„É´„Å®„Çµ„É†„Éç„Ç§„É´Êõ¥Êñ∞
      articleTitle.textContent = article.title;
      document.querySelector('.thumbnail').src = article.thumbnail;
      
      // ÂÖ¨ÈñãÊó•Êõ¥Êñ∞
      articleDate.textContent = `üìÖ ${article.publishDate}„Å´ÂÖ¨Èñã`;
      
      // Ë®ò‰∫ãURL„É™„É≥„ÇØÊõ¥Êñ∞
      const articleLink = document.getElementById('articleLink');
      articleLink.href = article.url;
      
      // playlist.jsonË™≠„ÅøËæº„Åø
      try {
        const response = await fetch(audioBasePath + 'playlist.json');
        const playlist = await response.json();
        
        // ÈÅ∏Êäû„Åï„Çå„ÅüË©±ËÄÖ„Å´ÂØæÂøú„Åô„Çã„ÉÅ„É£„É≥„ÇØ„ÇíÂèñÂæó
        let voiceId;
        if (currentVoice === 'ja-male') {
          voiceId = 'ja-male';
        } else if (currentVoice === 'ja-female') {
          voiceId = 'ja-female';
        } else if (currentVoice === 'zundamon') {
          voiceId = 'zundamon';
        } else {
          voiceId = 'ja-normal';  // „Éá„Éï„Ç©„É´„Éà
        }
        
        // ÈÅ∏Êäû„Åï„Çå„ÅüË©±ËÄÖ„ÅÆ„ÉÅ„É£„É≥„ÇØ„Éï„Ç°„Ç§„É´„ÇíÁõ¥Êé•ÊßãÁØâ
        const chunkCount = playlist.totalChunks || 3;
        const chunks = [];
        for (let i = 1; i <= chunkCount; i++) {
          const chunkNum = i.toString().padStart(2, '0');
          chunks.push(`article_${voiceId}_chunk_${chunkNum}.mp3`);
        }
        
        currentChunks = chunks.map(chunk => audioBasePath + chunk);
        currentChunkIndex = 0;
        audio.src = currentChunks[0];
        console.log(`Loading chunks for ${voiceId}:`, currentChunks);
        
        // „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÂá¶ÁêÜ„ÅØÂâäÈô§ÔºàÂ∏∏„Å´„ÉÅ„É£„É≥„ÇØÂΩ¢Âºè„Çí‰ΩøÁî®Ôºâ
        if (false) {
          // playlist.json„Å´Ë©≤ÂΩìË©±ËÄÖ„Åå„Å™„ÅÑÂ†¥Âêà„ÄÅÂçò‰∏Ä„Éï„Ç°„Ç§„É´„ÇíË©¶Ë°å
          let filename;
          if (currentVoice === 'ja-male') {
            filename = 'article_ja-male.mp3';
          } else if (currentVoice === 'ja-female') {
            filename = 'article_ja-female.mp3';
          } else if (currentVoice === 'zundamon') {
            filename = 'article_zundamon.wav';
          } else {
            filename = 'article_ja-normal.mp3';
          }
          currentChunks = [audioBasePath + filename];
          currentChunkIndex = 0;
          audio.src = currentChunks[0];
        }
      } catch (error) {
        console.error('Failed to load playlist.json:', error);
        // „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ: Âçò‰∏Ä„Éï„Ç°„Ç§„É´„ÇíË©¶Ë°å
        let filename;
        if (currentVoice === 'ja-male') {
          filename = 'article_ja-male.mp3';
        } else if (currentVoice === 'ja-female') {
          filename = 'article_ja-female.mp3';
        } else if (currentVoice === 'zundamon') {
          filename = 'article_zundamon.wav';
        } else {
          filename = 'article_ja-normal.mp3';
        }
        currentChunks = [audioBasePath + filename];
        currentChunkIndex = 0;
        audio.src = currentChunks[0];
      }
      
      updateArticleInfo();
      updateButtons();
      renderArticleList();
      
      // ÂÜçÁîü„Éú„Çø„É≥„Çí„ÄåPlay„Äç„Å´„É™„Çª„ÉÉ„Éà
      playBtn.textContent = 'Play';
      audio.pause();
    }
    
    // „Éú„Çø„É≥Áä∂ÊÖãÊõ¥Êñ∞
    function updateButtons() {
      prevBtn.disabled = currentArticleIndex === 0;
      nextBtn.disabled = currentArticleIndex === articles.length - 1;
    }
    
    // ÊôÇÈñì„Éï„Ç©„Éº„Éû„ÉÉ„Éà
    function formatTime(seconds) {
      const mins = Math.floor(seconds / 60);
      const secs = Math.floor(seconds % 60);
      return `${mins}:${secs.toString().padStart(2, '0')}`;
    }
    
    // ÂÜçÁîü/‰∏ÄÊôÇÂÅúÊ≠¢
    playBtn.addEventListener('click', () => {
      if (audio.paused) {
        audio.play();
      } else {
        audio.pause();
      }
    });
    
    // Ââç„Å∏
    prevBtn.addEventListener('click', () => {
      if (currentArticleIndex > 0) {
        loadArticle(currentArticleIndex - 1);
      }
    });
    
    // Ê¨°„Å∏
    nextBtn.addEventListener('click', () => {
      if (currentArticleIndex < articles.length - 1) {
        loadArticle(currentArticleIndex + 1);
      }
    });
    
    // ÂÜçÁîüÁä∂ÊÖãÊõ¥Êñ∞
    audio.addEventListener('play', () => {
      playBtn.textContent = 'Pause';
    });
    
    audio.addEventListener('pause', () => {
      playBtn.textContent = 'Play';
    });
    
    // ÈÄ≤ÊçóÊõ¥Êñ∞
    audio.addEventListener('timeupdate', () => {
      currentTimeDisplay.textContent = formatTime(audio.currentTime);
      
      // duration„ÅåÊúâÂäπ„Å™Â†¥Âêà„ÅÆ„Åø„Éó„É≠„Ç∞„É¨„Çπ„Éê„ÉºÊõ¥Êñ∞
      if (!isNaN(audio.duration) && audio.duration > 0 && isFinite(audio.duration)) {
        const progress = (audio.currentTime / audio.duration) * 100;
        progressBar.style.width = `${progress}%`;
        progressContainer.setAttribute('aria-valuenow', Math.round(progress));
      }
    });
    
    // Á∑èÊôÇÈñìË°®Á§∫
    audio.addEventListener('loadedmetadata', () => {
      if (isFinite(audio.duration)) {
        totalTimeDisplay.textContent = formatTime(audio.duration);
      } else {
        // duration„ÅåÂèñÂæó„Åß„Åç„Å™„ÅÑÂ†¥Âêà„ÅØ"--:--"Ë°®Á§∫
        totalTimeDisplay.textContent = '--:--';
      }
      hideLoading();
    });
    
    // Èü≥Â£∞„É≠„Éº„ÉâÈñãÂßã
    audio.addEventListener('loadstart', () => {
      showLoading();
    });
    
    // Èü≥Â£∞„É≠„Éº„Éâ„Ç®„É©„Éº
    audio.addEventListener('error', () => {
      hideLoading();
      console.error('Audio load error:', audio.error);
    });
    
    // „ÉÅ„É£„É≥„ÇØÁµÇ‰∫ÜÊôÇ„ÅÆÂá¶ÁêÜÔºàÈÄ£Á∂öÂÜçÁîüÔºâ
    audio.addEventListener('ended', () => {
      // Ê¨°„ÅÆ„ÉÅ„É£„É≥„ÇØ„Åå„ÅÇ„Çå„Å∞ÂÜçÁîü
      if (currentChunkIndex < currentChunks.length - 1) {
        currentChunkIndex++;
        audio.src = currentChunks[currentChunkIndex];
        audio.play();
      } else {
        // „Åô„Åπ„Å¶„ÅÆ„ÉÅ„É£„É≥„ÇØÂÜçÁîüÂÆå‰∫Ü„ÄÅÊ¨°„ÅÆË®ò‰∫ã„Å∏
        if (currentArticleIndex < articles.length - 1) {
          loadArticle(currentArticleIndex + 1);
          audio.play();
        }
      }
    });
    
    // „Éó„É≠„Ç∞„É¨„Çπ„Éê„Éº„ÇØ„É™„ÉÉ„ÇØ„Éª„Éâ„É©„ÉÉ„Ç∞„Åß„Ç∑„Éº„ÇØ
    const seekToPosition = (e) => {
      // duration„ÅåÊúâÂäπ„Å™Â†¥Âêà„ÅÆ„Åø„Ç∑„Éº„ÇØÂÆüË°å
      if (!audio.duration || isNaN(audio.duration) || audio.duration <= 0 || !isFinite(audio.duration)) {
        return;
      }
      
      performSeek(e);
    };
    
    const performSeek = (e) => {
      // duration„ÅåÁÑ°Âäπ„Å™Â†¥Âêà„ÅØ„Ç∑„Éº„ÇØÁÑ°ÂäπÂåñ
      if (!audio.duration || isNaN(audio.duration) || audio.duration <= 0 || !isFinite(audio.duration)) {
        return;
      }
      
      const rect = progressContainer.getBoundingClientRect();
      
      // „Çø„ÉÉ„ÉÅ„Ç§„Éô„É≥„Éà„Å®„Éû„Ç¶„Çπ„Ç§„Éô„É≥„Éà„ÅÆ‰∏°Êñπ„Å´ÂØæÂøú
      let clientX;
      if (e.type && e.type.startsWith('touch')) {
        // „Çø„ÉÉ„ÉÅ„Ç§„Éô„É≥„Éà„ÅÆÂ†¥Âêà
        if (e.touches && e.touches.length > 0) {
          clientX = e.touches[0].clientX;
        } else if (e.changedTouches && e.changedTouches.length > 0) {
          clientX = e.changedTouches[0].clientX;
        } else {
          return; // „Çø„ÉÉ„ÉÅÊÉÖÂ†±„Åå„Å™„ÅÑÂ†¥Âêà„ÅØÂá¶ÁêÜ„Åó„Å™„ÅÑ
        }
      } else {
        // „Éû„Ç¶„Çπ„Ç§„Éô„É≥„Éà„ÅÆÂ†¥Âêà
        clientX = e.clientX;
      }
      
      if (clientX === undefined) return;
      
      const clickX = Math.max(0, Math.min(rect.width, clientX - rect.left));
      const percentage = clickX / rect.width;
      const newTime = audio.duration * percentage;
      
      if (isFinite(newTime) && newTime >= 0 && newTime <= audio.duration) {
        const wasPlaying = !audio.paused;
        audio.currentTime = newTime;
        
        // ÂÖÉ„ÄÖÂÜçÁîü‰∏≠„Å†„Å£„ÅüÂ†¥Âêà„ÅØÂÜçÁîü„ÇíÁ∂ôÁ∂ö
        if (wasPlaying && audio.paused) {
          audio.play();
        }
      }
    };
    
    // „Éû„Ç¶„Çπ„Éâ„É©„ÉÉ„Ç∞ÈñãÂßã
    progressContainer.addEventListener('mousedown', (e) => {
      isDragging = true;
      dragStarted = false;
    });
    
    // „Éû„Ç¶„ÇπÁßªÂãï
    document.addEventListener('mousemove', (e) => {
      if (isDragging) {
        dragStarted = true;
        seekToPosition(e);
      }
    });
    
    // „Éû„Ç¶„Çπ„Éâ„É©„ÉÉ„Ç∞ÁµÇ‰∫Ü
    document.addEventListener('mouseup', (e) => {
      if (isDragging) {
        if (!dragStarted) {
          seekToPosition(e);
        }
        isDragging = false;
        dragStarted = false;
      }
    });
    
    // „Çø„ÉÉ„ÉÅÊìç‰ΩúÂØæÂøú
    progressContainer.addEventListener('touchstart', (e) => {
      e.preventDefault();
      isDragging = true;
      dragStarted = false;
    }, { passive: false });
    
    progressContainer.addEventListener('touchmove', (e) => {
      if (isDragging) {
        e.preventDefault();
        dragStarted = true;
        seekToPosition(e);
      }
    }, { passive: false });
    
    progressContainer.addEventListener('touchend', (e) => {
      if (isDragging) {
        if (!dragStarted) {
          seekToPosition(e);
        }
        isDragging = false;
        dragStarted = false;
      }
    });
    
    // „Ç≠„Éº„Éú„Éº„ÉâÊìç‰ΩúÂØæÂøú
    progressContainer.addEventListener('keydown', (e) => {
      if (!audio.duration || !isFinite(audio.duration)) return;
      
      const step = 5; // 5ÁßíÂçò‰Ωç„ÅßÁßªÂãï
      
      switch(e.key) {
        case 'ArrowLeft':
          audio.currentTime = Math.max(0, audio.currentTime - step);
          e.preventDefault();
          break;
        case 'ArrowRight':
          audio.currentTime = Math.min(audio.duration, audio.currentTime + step);
          e.preventDefault();
          break;
        case 'Home':
          audio.currentTime = 0;
          e.preventDefault();
          break;
        case 'End':
          audio.currentTime = audio.duration;
          e.preventDefault();
          break;
      }
    });
    
    // ÂÜçÁîüÈÄüÂ∫¶Â§âÊõ¥
    speedSelect.addEventListener('change', () => {
      audio.playbackRate = parseFloat(speedSelect.value);
    });
    
    // „Éä„É¨„Éº„Çø„ÉºÂ§âÊõ¥
    voiceSelect.addEventListener('change', () => {
      currentVoice = voiceSelect.value;
      const wasPlaying = !audio.paused;
      const currentTime = audio.currentTime;
      
      loadArticle(currentArticleIndex);
      
      audio.addEventListener('loadedmetadata', () => {
        audio.currentTime = currentTime;
        if (wasPlaying) {
          audio.play();
        }
      }, { once: true });
    });
    
    // Èü≥ÈáèË™øÊï¥
    volumeSlider.addEventListener('input', () => {
      const volume = volumeSlider.value / 100;
      audio.volume = volume;
      volumeValue.textContent = `${volumeSlider.value}%`;
    });
    
    // ÂàùÊúüÈü≥ÈáèË®≠ÂÆö
    audio.volume = 0.5;
    
    // ÂàùÊúüÂÜçÁîüÈÄüÂ∫¶Ë®≠ÂÆö
    audio.playbackRate = 1.4;
    
    // ÂàùÊúüÂåñ
    loadArticles();
  </script>
</body>
</html>
